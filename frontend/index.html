<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XenArch - Terrain Analysis</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="my-4 text-center">
            <h1>XenArch Terrain Analysis</h1>
            <p class="lead">Upload a GeoTIFF file to analyze terrain patterns using fractal dimensions</p>
        </header>

        <!-- Main Content -->
        <main>
            <div class="row">
                <!-- Upload Form -->
                <div class="col-lg-6">
                    <div class="card shadow-sm mb-4">
                        <div class="card-header bg-primary text-white">
                            <h3 class="card-title mb-0">Upload & Configure</h3>
                        </div>
                        <div class="card-body">
                            <form id="upload-form">
                                <!-- File Upload -->
                                <div class="mb-3">
                                    <label for="terrain-file" class="form-label">GeoTIFF Terrain File</label>
                                    <input class="form-control" type="file" id="terrain-file" name="file" accept=".tif,.tiff" required>
                                    <div class="form-text">Upload a GeoTIFF terrain elevation file.</div>
                                </div>

                                <h4 class="mt-4 mb-3">Analysis Parameters</h4>

                                <!-- Grid Size -->
                                <div class="mb-3">
                                    <label for="grid-size" class="form-label">Grid Size</label>
                                    <div class="input-group">
                                        <input type="number" class="form-control" id="grid-size" name="grid_size" value="512" min="128" max="2048" step="64" required>
                                        <span class="input-group-text">pixels</span>
                                    </div>
                                    <div class="form-text">Size of each terrain patch (larger = more detail but slower).</div>
                                </div>

                                <!-- Overlap -->
                                <div class="mb-3">
                                    <label for="overlap" class="form-label">Overlap</label>
                                    <div class="input-group">
                                        <input type="number" class="form-control" id="overlap" name="overlap" value="64" min="0" max="256" step="16" required>
                                        <span class="input-group-text">pixels</span>
                                    </div>
                                    <div class="form-text">Overlap between adjacent grid cells.</div>
                                </div>

                                <div class="row">
                                    <!-- Fractal Dimension Min -->
                                    <div class="col-md-6 mb-3">
                                        <label for="fd-min" class="form-label">Fractal Dimension Min</label>
                                        <input type="number" class="form-control" id="fd-min" name="fd_min" value="0.0" min="0.0" max="3.0" step="0.1" required>
                                        <div class="form-text">Minimum fractal dimension threshold.</div>
                                    </div>

                                    <!-- Fractal Dimension Max -->
                                    <div class="col-md-6 mb-3">
                                        <label for="fd-max" class="form-label">Fractal Dimension Max</label>
                                        <input type="number" class="form-control" id="fd-max" name="fd_max" value="0.8" min="0.0" max="3.0" step="0.1" required>
                                        <div class="form-text">Maximum fractal dimension threshold.</div>
                                    </div>
                                </div>

                                <!-- R² Minimum -->
                                <div class="mb-3">
                                    <label for="r2-min" class="form-label">R² Minimum</label>
                                    <input type="number" class="form-control" id="r2-min" name="r2_min" value="0.8" min="0.0" max="1.0" step="0.05" required>
                                    <div class="form-text">Minimum R-squared value for statistical significance.</div>
                                </div>

                                <!-- Max Samples -->
                                <div class="mb-3">
                                    <label for="max-samples" class="form-label">Max Samples to Display</label>
                                    <input type="number" class="form-control" id="max-samples" name="max_samples" value="16" min="1" max="100" step="1" required>
                                    <div class="form-text">Maximum number of top samples to display in results.</div>
                                </div>

                                <!-- CPU Fraction -->
                                <div class="mb-3">
                                    <label for="cpu-fraction" class="form-label">CPU Usage</label>
                                    <div class="input-group">
                                        <input type="range" class="form-range form-control" id="cpu-fraction" name="cpu_fraction" value="0.8" min="0.1" max="1.0" step="0.1" required>
                                        <span class="input-group-text" id="cpu-fraction-value">80%</span>
                                    </div>
                                    <div class="form-text">Fraction of CPU cores to use for processing.</div>
                                </div>

                                <!-- Submit Button -->
                                <div class="mt-4">
                                    <button type="submit" class="btn btn-primary btn-lg w-100" id="submit-button">
                                        <i class="fas fa-play-circle me-2"></i>Start Analysis
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- Processing Status and Results -->
                <div class="col-lg-6">
                    <!-- Processing Status -->
                    <div class="card shadow-sm mb-4" id="status-card" style="display: none;">
                        <div class="card-header bg-info text-white">
                            <h3 class="card-title mb-0">Processing Status</h3>
                        </div>
                        <div class="card-body">
                            <div id="status-content">
                                <div class="my-4">
                                    <!-- Processing stages -->
                                    <div class="mb-4">
                                        <div class="d-flex justify-content-between mb-2">
                                            <h5 class="mb-0">Progress</h5>
                                            <span class="text-muted" id="progress-percentage">0%</span>
                                        </div>
                                        <!-- Loading bar -->
                                        <div class="progress" style="height: 20px;">
                                            <div id="progress-bar" class="progress-bar progress-bar-striped progress-bar-animated" 
                                                role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                                        </div>
                                    </div>
                                    
                                    <!-- Processing stages -->
                                    <div class="mb-3">
                                        <ul class="list-group" id="processing-stages">
                                            <li class="list-group-item d-flex justify-content-between align-items-center" id="stage-upload">
                                                <span><i class="fas fa-file-upload me-2"></i> File Upload</span>
                                                <span class="badge bg-secondary" id="stage-upload-status">Waiting</span>
                                            </li>
                                            <li class="list-group-item d-flex justify-content-between align-items-center" id="stage-processing">
                                                <span><i class="fas fa-cogs me-2"></i> Processing</span>
                                                <span class="badge bg-secondary" id="stage-processing-status">Waiting</span>
                                            </li>
                                            <li class="list-group-item d-flex justify-content-between align-items-center" id="stage-results">
                                                <span><i class="fas fa-chart-bar me-2"></i> Results</span>
                                                <span class="badge bg-secondary" id="stage-results-status">Waiting</span>
                                            </li>
                                        </ul>
                                    </div>
                                    
                                    <h5 class="mb-2">Details</h5>
                                    <!-- Status details with collapsible option -->
                                    <div class="bg-light border rounded">
                                        <div class="d-flex justify-content-between align-items-center p-2 border-bottom">
                                            <span class="fw-bold">Debug Information</span>
                                            <button class="btn btn-sm btn-outline-secondary" id="toggle-details">
                                                <i class="fas fa-chevron-down"></i>
                                            </button>
                                        </div>
                                        <pre id="status-details" class="text-start p-3 mb-0" style="max-height: 200px; overflow-y: auto;">Debug mode - Status details will appear here</pre>
                                    </div>

                                    <h4 class="mt-3" id="status-message">Analysis in progress...</h4>
                                    <p class="text-muted" id="job-id"></p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Results Display -->
                    <div class="card shadow-sm" id="results-card" style="display: none;">
                        <div class="card-header bg-success text-white">
                            <h3 class="card-title mb-0">Analysis Results</h3>
                        </div>
                        <div class="card-body">
                            <div id="results-summary" class="mb-4">
                                <!-- Summary statistics will go here -->
                            </div>
                            <div id="results-grid" class="row g-3">
                                <!-- Grid items will be populated here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Footer -->
        <footer class="mt-5 mb-3 text-center text-muted">
            <p>XenArch Terrain Analysis Tool &copy; 2023</p>
        </footer>

        <!-- Modal for Detailed View -->
        <div class="modal fade" id="detail-modal" tabindex="-1" aria-labelledby="detail-modal-label" aria-hidden="true">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="detail-modal-label">Terrain Grid Details</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body" id="detail-modal-content">
                        <!-- Grid details will be populated here -->
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        <a href="#" class="btn btn-primary" id="download-tif">Download GeoTIFF</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/config.js"></script>
    <script src="js/main.js"></script>
</body>
</html> 